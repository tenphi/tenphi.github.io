import{W as t,s,d as i,i as e}from"./index-957404e9.js";export default class extends t{static get params(){return{input:!0,provideValue:!0}}init(){this.isPopup=this.host.hasAttribute("nu-popup"),this.isPopup&&this.forceLinkValue(),this.host.nuListBox=this,this.options=[],super.init(),this.setName("listbox"),this.setContext("listbox",this,!0),this.linkContext("button",t=>{t&&this.linkValue&&(t.listbox=this,t.popup&&t.setAria("haspopup","listbox"))}),this.on("keydown",t=>{this.onKeyDown(t)})}setValue(t,i){t!==this.value&&(super.setValue(t,i),setTimeout(()=>{const t=this.activeOption;t&&s(this.host,t.host)}))}onKeyDown(t){const s=this.orderedOptions,i=this.activeOption;if(!s.length||i&&!s.includes(i))return;const e=s.indexOf(i);let o;switch(t.key){case"Home":if(!this.isEdgeMoveAllowed())return;o=s[0].value;break;case"End":if(!this.isEdgeMoveAllowed())return;o=s.slice(-1)[0].value;break;case"ArrowUp":if(e>0)o=s[e-1].value;else{if(-1!==e)return;o=s.slice(-1)[0].value}this.openPopup();break;case"ArrowDown":if(e<s.length-1)o=s[e+1].value;else{if(-1!==e)return;o=s[0].value}this.openPopup();break;case"Enter":t.target===this.host&&this.isPopup&&this.nu("popup").then(t=>t.close());default:return}t.nuListBoxHandled=!0,setTimeout(()=>{this.setValue(o)}),t.preventDefault()}isEdgeMoveAllowed(){if(!this.isPopup)return!0;const t=this.host.nuPopup;return!t||t.isOpen}openPopup(){if(!this.isPopup)return;const t=this.host.nuPopup;t&&!t.isOpen&&this.button&&this.button.set(!0,!0)}addOption(t){this.options.includes(t)||this.options.push(t)}get orderedOptions(){const t=this.options.map(t=>t.host);return i(this.host,"[nu-option]:not([disabled])").filter(s=>t.includes(s)).map(t=>this.options.find(s=>s.host===t)).filter(t=>t)}get activeOption(){return this.options.find(t=>e(t.value,this.value))}removeOption(t){this.options.includes(t)||this.options.splice(this.options.indexOf(t),1)}getOptionByValue(t){return this.options.find(s=>e(s.value,t))}}
