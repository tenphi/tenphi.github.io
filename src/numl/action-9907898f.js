import{W as t,A as s,h as e,g as i,q as o,j as h,k as r,i as l}from"./index-957404e9.js";export default class extends t{static get params(){return{input:!0,role:"button"}}init(){this.value=null,this.offValue=null,this.require("active","focusable");const t=s(this.host,"pressed");this.props.to=null,this.props.pressed=t=>this.set(null!=t,!0),this.props.checked=t,this.props.selected=t,this.setMod("action",!0),super.init();const{host:e}=this;e.nuAction=this,this.on("keydown",t=>{"Escape"===t.key&&e.nuHasAria("expanded")&&this.set(!1),this.listbox&&(this.ignorePopup=!0,t.nuListBoxHandled||(this.listbox.host.focus(),this.listbox.onKeyDown(t)),setTimeout(()=>{this.ignorePopup=!1},100))}),this.radioGroup=null,this.to&&this.changed("to",this.to)}connected(){super.connected(),this.linkContext("radiogroup",()=>this.verifyRadioGroup(),"radioGroup"),"button"===this.role&&this.to&&(this.role="link"),this.createLink(),this.setContext("button",this)}disconnected(){this.radioGroup&&this.radioGroup.removeItem(this)}changed(t,s){if(super.changed(t,s),"to"===t){this.createLink();const{$link:t}=this;t&&(t.href=this.href,t.target=this.newTab?"_blank":"_self")}}verifyRadioGroup(){const t=this.radioGroup;t&&(t.addItem(this),this.setAttr("link-value",""),this.role=t.params.itemRole,null==this.value&&(t.counter||(t.counter=0),this.setValue(String(t.counter++))),this.fromContextValue(t.value))}linkPopup(t){this.popup||(this.popup=t,this.setAria("haspopup",!0),this.setAria("expanded",this.pressed||!1),this.setMod("dropdown",!0),this.listbox&&this.setAria("haspopup","listbox"))}unlinkPopup(t){if(this.popup!==t)return;const{host:s}=this;delete this.popup,s.nuSetAria("haspopup",null),s.nuSetAria("expanded",null),this.role=this.host.constructor.nuRole,this.setMod("dropdown",!1)}createLink(){const{host:t}=this;let s;this.to?(this.$link?s=this.$link:(s=e("a"),s.href=this.href,s.target=this.newTab?"_blank":"_self",s.setAttribute("tabindex","-1"),s.setAttribute("aria-hidden","true"),s.setAttribute("role","none"),this.$link=s,setTimeout(()=>{t.appendChild(this.$link),i(t)}),this.$link.addEventListener("click",t=>{this.disabled?t.preventDefault():(0!==t.button||this.disabled||this.tap(t),t.stopPropagation())})),s.href=this.href,s.target=this.newTab?"_blank":"_self",(s&&s.href).includes("//")?this.$link.setAttribute("rel","noreferrer"):this.$link.removeAttribute("rel")):this.$link&&(delete this.$link,t.removeChild(this.$link))}tap(t){const{host:s}=this;if(this.to&&t.target!==this.$link)this.$link.click();else{if(this.to&&t.target===this.$link&&this.href.startsWith("#")){const e=this.href.slice(1),i=o(s,e);if(i)return i.scrollIntoView({behavior:"smooth"}),location.hash=e,t.preventDefault(),h(!0),void setTimeout(()=>{this.emit("tap"),setTimeout(()=>{h()})},0)}if(!(this.disabled||this.isRadio()&&this.pressed)){if(this.scrollto&&s.nuScrollTo(this.scrollto),this.to){const s=this.to,e=s.replace(/^!/,""),i=s.startsWith("!")||t.metaKey||t.shiftKey;r.route(e,i)||(t.preventDefault(),t.stopPropagation()),this.doAction("close",!0)}setTimeout(()=>{this.emit("tap"),setTimeout(()=>{h()})},0),this.isToggle()?this.toggle():(this.popup||this.control(),this.doActions(this.value))}}}get emitValue(){return this.isToggle()?null!=this.value?this.pressed?this.value:null!=this.offValue?this.offValue:this.value:this.pressed:this.value}toggle(){this.isToggle()&&(this.pressed&&!this.isUnpressable()||this.set(!this.pressed))}set(t,s,e){if(t===this.pressed)return;if(!this.isToggle()&&!e)return;const{host:i}=this;t=t||!1,this.pressed=t,t&&this.isRadio()&&this.radioGroup&&this.radioGroup.setCurrent(this),this.popup?i.nuSetAria("expanded",t):this.isCheckbox()?i.nuSetAria("checked",t):this.isSelectable()?i.nuSetAria("selected",t):i.nuSetAria("pressed",t),!s&&this.isToggle()&&(this.emit("pressed",this.pressed),this.popup||this.emit("input",this.emitValue)),this.popup||this.control(s&!this.hasAttr("trigger")),t&&this.listbox&&this.listbox.host.focus(),this.setMod("pressed",t),this.setContext("disabled",!t),t&&this.doActions(this.value),this.toggleInnerPopup()}toggleInnerPopup(t){const s=this.host.nuDeepQuery("[is-popup]"),e=null==t?this.pressed?"open":"close":t?"open":"close";s&&s.nuPopup[e]()}setValue(t,s){this.ignorePopup||this.toggleInnerPopup(!1),super.setValue(t,s)}setByValue(t){let s=this.value,e=this.offValue;if(null!=s)return s=this.getTypedValue(s),l(s,t)?this.set(!0):(null!=e&&(e=this.getTypedValue(e)),this.set(!1));this.set(null!=t)}isToggle(){const{host:t}=this;return t.hasAttribute("toggle")||t.nuHasAria("pressed")||t.nuHasAria("expanded")||t.nuHasAria("checked")||t.nuHasAria("selected")||["checkbox","radio","tab","switch"].includes(this.role)}isUnpressable(){return!["radio","tab"].includes(this.role)}isRadio(){return["radio","tab"].includes(this.role)}isSelectable(){return["tab"].includes(this.role)}isCheckbox(){return["radio","checkbox","switch"].includes(this.role)}fromContextValue(t){this.isToggle()&&null!=t&&this.set(l(this.value,t))}control(t){let s=null;this.isToggle()&&!this.valueBubbled&&(s=!!this.pressed),this.nu("control").then(e=>e.apply(s,this.getTypedValue(this.emitValue),t))}get href(){const{to:t=""}=this;return t.replace(/^!/,"")}get newTab(){const{to:t=""}=this;return t.startsWith("!")}}
